name: Deploy to Amazon ECS

on:
  push:
    branches:
      - "master"

                                               
permissions:
  contents: read
  

jobs:
  deploy-infra:
    name: deploy-infra
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: infracode/dev/us-east-1/infra/vpc
    env:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      AWS_DEFAULT_REGION: us-east-1
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Setup Terragrunt
        uses: autero1/action-terragrunt@v1.1.0
        with:
          terragrunt_version: v0.38.6
      - name: Interact with Terragrunt
        run: terragrunt --version
      - name: Terragrunt plan
        run: terragrunt plan
      - name: Terragrunt apply
        run: terragrunt apply -auto-approve
